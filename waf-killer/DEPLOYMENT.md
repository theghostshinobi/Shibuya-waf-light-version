<!-- FILE: DEPLOYMENT.md -->
<!-- LAST UPDATED: 2026-01-26 -->
<!-- GENERATED BY: WAF KILLER Documentation Generator -->

# üöÄ Production Deployment Guide

Guide for deploying WAF KILLER in production-grade environments.

## ‚úÖ Production Checklist

- [ ] TLS Certificates (Let's Encrypt or custom).
- [ ] High Availability PostgreSQL (Primary + Standby).
- [ ] Redis Cluster for shared rate-limiting state.
- [ ] eBPF permissions or `CAP_NET_ADMIN` capabilities.
- [ ] Resource limits (Memory/CPU) configured.
- [ ] Monitoring (Prometheus/Grafana) integration.

---

## üõ†Ô∏è Deployment Options

### 1. Kubernetes (Helm)
The recommended approach for cloud-native scaling.

```bash
# Add the helm repo
helm repo add waf-killer https://charts.waf-killer.io

# Create a values.yaml with your config
helm install waf-killer waf-killer/waf-killer -f values.yaml
```

### 2. Docker Compose (Single Host)
Suitable for small to medium workloads.

```yaml
version: '3.8'
services:
  waf:
    image: ghcr.io/your-repo/waf-killer:latest
    cap_add:
      - NET_ADMIN
    ports:
      - "80:8080"
    volumes:
      - ./config:/etc/waf-killer
```

### 3. Terraform (Infrastructure-as-Code)
Automate your infrastructure setup on AWS/GCP/Azure.

```hcl
module "waf_killer" {
  source = "./modules/waf-killer"
  cluster_name = "prod-waf"
  instance_type = "t3.medium"
}
```

---

## ‚öôÔ∏è Configuration for Production

### TLS Setup
Enable HTTPS termination within the proxy engine.

```yaml
tls:
  enabled: true
  cert_path: "/etc/ssl/certs/waf.crt"
  key_path: "/etc/ssl/private/waf.key"
  min_version: "1.3"
```

### Observability
Integrate with your existing monitoring stack.

```yaml
metrics:
  enabled: true
  path: "/metrics"
  port: 9090 # Prometheus endpoint

logging:
  format: "json"
  destination: "loki"
  loki_url: "http://loki:3100/loki/api/v1/push"
```

---

## üèóÔ∏è High Availability Setup

To ensure zero downtime, deploy WAF KILLER behind a Layer 4 Load Balancer (like AWS NLB or HAProxy).

- **Shared State**: Use an external Redis Cluster for consistent rate-limiting across all nodes.
- **Health Checks**: Configure your LB to monitor the `/health` endpoint (Port 8080).
- **Graceful Shutdown**: WAF KILLER supports SIGTERM for draining connections before exit.

---

## üõ°Ô∏è Security Hardening

1. **Least Privilege**: Never run as `root`. Use `setcap` to grant network permissions only.
2. **Secrets Management**: Use Vault or Kubernetes Secrets to inject database and API credentials.
3. **Internal Firewall**: Restrict Redis and PostgreSQL access only to the WAF instances.

---

## üìà Performance Tuning

- **Worker Threads**: Set to matches the number of CPU cores ($N$).
- **Connection Pools**: Increase `max_connections` for PostgreSQL in high-traffic scenarios.
- **eBPF Acceleration**: Ensure XDP is enabled on your network interface for kernel-level filtering.

---

## üîÑ Upgrade Strategy

- **Blue-Green Deployment**: Spin up a new cluster, verify health, then switch traffic.
- **Canary Releases**: Route 5% of traffic to the new version to monitor for false positives or performance regressions.
