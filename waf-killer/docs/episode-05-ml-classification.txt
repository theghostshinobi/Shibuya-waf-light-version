EPISODE 5: ML CLASSIFICATION LAYER 2 (THE JUDGE)

We have ascended. The WAF is no longer a blind gatekeeper; it is a JUDGE.
It does not just say "STOP". It says "GUILTY of SQL Injection".

1. CLASSIFICATION LAYER
   We added a multi-class SVM/XGBoost classifier that identifies:
   - SQLi
   - XSS
   - RCE
   - LFI/Path Traversal
   - Command Injection
   - Benign

   This runs efficiently via ONNX Runtime (<5ms).

2. EXPLAINABILITY (SHAP)
   Every decision is explained.
   "Blocked because: feature 'suspicious_keywords' contributed +0.9 to SQLi prob."
   We use pre-computed global feature importance mapped to local feature values for high-speed explanation.

3. SCORING LOGIC
   The Rule Engine now combines 3 signals:
   - CRS (Signatures): Precision.
   - ML Anomaly (Layer 1): Detection of unknown unknowns.
   - ML Classification (Layer 2): Specificity and Confirmation.

   Score = CRS + AnomalyWeight + ClassificationWeight
   
4. FEEDBACK LOOP
   The system learns.
   False Positives -> Labeled -> Feedback Database -> Retrain.
   The `FeedbackManager` handles the cycle of life.

NEXT: Episode 6 - Redis Caching & Rate Limiting (The Timekeeper). or CLI?
Actually, prompt said Episode 7 is CLI. Next is likely Episode 6 (Performance/Caching).
The WAF is now SENTIENT.
